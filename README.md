# 数据集管理器

一个基于 PyQt5 的数据集管理工具，支持图片和视频文件的浏览、预览和管理。

## 功能特性

1. 三栏布局界面（文件管理、预览、详情），默认比例为2:6:2
2. 文件夹导入和树形结构展示（通过文件选择对话框）
3. 图片预览支持：
   - 原始分辨率显示
   - Ctrl+滚轮缩放
   - Shift+滚轮水平滚动
4. 视频预览（基础支持）
5. 回收站功能：
   - 文件删除到回收站
   - 回收站文件还原
   - 彻底删除文件
6. 自动标注功能：
   - 支持YOLO模型自动标注
   - 支持OpenAI视觉模型自动标注
   - 生成YOLO格式标注文件
7. 数据集划分功能：
   - 将数据集划分为训练集、验证集和测试集
   - 生成符合YOLO格式的目录结构和配置文件
8. 数据源管理：
   - 支持直播流数据源
   - 实时播放和预览
9. 远程服务器支持：
   - SSH连接远程服务器
   - 上传和下载文件

## 环境要求

- Python >= 3.9
- opencv-python
- PyQt5
- ultralytics (用于YOLO模型)
- openai (用于OpenAI模型)
- paramiko (用于SSH连接)

## 安装依赖

### 推荐使用 uv（更快的包管理器）
```bash
# 首次安装依赖
uv sync

# 如果遇到平台兼容性问题
uv sync --python-platform win32
```

### 传统方式安装
```bash
pip install -r requirements.txt
```

### 不同操作系统的安装说明

#### Windows
使用 uv 安装（推荐）：
```bash
uv sync
```

如果遇到 PyQt5 兼容性问题，可以尝试：
```bash
uv sync --python-platform win32
```

传统 pip 安装：
```bash
pip install -r requirements.txt
```

注意：在某些Windows系统上，可能需要安装Microsoft C++ Build Tools

#### macOS
如果遇到 PyQt5 安装问题，可以尝试：
```bash
brew install pyqt5
```
或者使用 conda:
```bash
conda install pyqt
```

#### Linux
在运行 pip install 之前，建议先安装系统依赖：

Ubuntu/Debian:
```bash
sudo apt-get update
sudo apt-get install python3-pyqt5 libgl1-mesa-glx libglib2.0-0 python3-dev
```

CentOS/RHEL/Fedora:
```bash
sudo yum install python3-qt5 mesa-libGL glib2-devel python3-devel
# Fedora 用户可使用 dnf 替代 yum
```

如果遇到 opencv-python 安装问题，可以尝试：
```bash
sudo apt-get install python3-opencv
```

## 运行应用

### 使用 uv 运行（推荐）
```bash
uv run main.py
```

### 使用 Python 直接运行
```bash
python main.py
```

如果使用 uv 时遇到平台兼容性问题，可以尝试指定平台：
```bash
uv run --python-platform win32 main.py
```

## 使用说明

### 1. 文件管理功能

#### 1.1 导入文件夹
- 点击左侧"📁 导入文件夹"按钮，通过文件选择对话框选择要管理的数据集文件夹
- 选中的文件夹会作为根路径显示在左侧文件管理区域
- 支持导入多个文件夹
- 导入的文件夹路径会被持久化保存，下次启动应用时会自动加载

#### 1.2 文件浏览
- 在左侧文件树中可以浏览导入的文件夹内容
- 文件树会显示文件名、大小、类型和修改时间
- 支持展开/折叠文件夹
- 单击文件夹可以展开或折叠
- 双击文件可以进行预览
- 支持通过搜索框搜索文件

#### 1.3 文件操作
- **删除文件**: 选中文件后按Delete键，或右键选择"删除"，文件将被移动到回收站
- **重命名文件/文件夹**: 右键选择"重命名"，输入新名称后按回车确认
- **新建文件夹**: 在文件夹上右键选择"新建文件夹"，输入文件夹名称后按回车确认
- **拖拽移动**: 可以拖拽文件或文件夹到其他文件夹进行移动
- **算法测试**: 在支持的文件上右键选择"算法测试"，可以在独立窗口中测试算法效果

#### 1.4 回收站功能
- 点击"🗑️ 回收站"按钮打开回收站对话框
- 回收站会显示所有被删除的文件及其原始路径、大小和删除时间
- 可以选择还原选中的文件或全部文件
- 可以彻底删除选中的文件或清空整个回收站
- 回收站中的文件会被保存在数据集目录下的delete文件夹中

#### 1.5 快捷键
- **Delete**: 删除选中的文件或文件夹
- **Enter**: 确认对话框中的操作
- **Esc**: 取消对话框中的操作

### 2. 图片预览和标注功能

#### 2.1 图片预览
- 在左侧文件树中双击图片文件进行预览
- 使用 Ctrl+滚轮 对图片进行缩放
- 使用 Shift+滚轮 对图片进行水平滚动
- 支持的图片格式：.jpg, .jpeg, .png, .bmp, .gif
- 图片会自动适应预览区域大小，保持原始宽高比

#### 2.2 图片标注
- 点击图片预览区域工具栏中的"矩形"或"多边形"按钮选择标注模式
- 按 **W** 键进入全局标注模式，输入标注标签后可以连续标注
- 按 **Q** 键退出标注模式
- **矩形标注**: 点击并拖拽绘制矩形框
- **多边形标注**: 依次点击添加顶点，点击起始点完成闭合
- 标注完成后会自动生成YOLO格式的标注文件(.txt)和类别文件(classes.txt)

#### 2.3 标注编辑
- **选择标注**: 点击标注框或标注区域选中
- **移动标注**: 选中标注后拖拽移动
- **调整大小**: 选中矩形标注后拖拽控制点调整大小
- **编辑标签**: 双击标注框编辑标签内容
- **删除标注**: 选中标注后按Delete键删除
- **编辑控制点**: 选中矩形或多边形的控制点后可以拖拽调整形状

#### 2.4 标注详情面板
- 右侧详情面板分为上下两部分：
  - 上部分(40%高度)：显示图片标签列表，按类别分组显示
  - 下部分(60%高度)：显示标签+点位信息的详细标注数据
- 可以在分类表中选择特定类别高亮显示对应标注
- 可以在详情表中选择特定标注进行编辑
- 支持批量删除选中的标注
- 详情面板与图片预览区域实时同步，选中某个标注时会在图片上高亮显示

#### 2.5 图片浏览快捷键
- **A**: 切换到前一张图片
- **D**: 切换到后一张图片
- **F11**: 切换全屏模式
- **Esc**: 退出全屏模式
- **W**: 进入全局标注模式
- **Q**: 退出标注模式
- **Delete**: 删除选中的标注

#### 2.6 标注工具栏说明
- **矩形工具**: 用于绘制矩形标注框
- **多边形工具**: 用于绘制多边形标注区域
- 工具栏还会显示当前的快捷键提示信息

### 3. 视频预览功能

#### 3.1 视频预览
- 在左侧文件树中双击视频文件进行预览
- 支持的视频格式：.mp4, .avi, .mov, .wmv, .flv, .mkv
- 视频会自动播放，支持基本的播放控制

#### 3.2 视频快捷键
- **A**: 切换到前一个视频
- **D**: 切换到后一个视频

### 4. 自动标注功能

#### 4.1 模型配置
- 点击菜单栏"自动标注" -> "模型配置"
- 点击"➕ 添加模型配置"创建新的模型配置
- 可以添加YOLO模型或OpenAI模型配置
- YOLO模型需要指定模型文件路径和分类列表
- OpenAI模型需要指定API密钥、模型名称和提示词
- 支持编辑和删除已有的模型配置

#### 4.2 自动标注
- 点击菜单栏"自动标注" -> "自动标注"
- 点击"➕ 添加标注任务"创建新的标注任务
- 选择配置好的模型和数据集路径
- 在任务列表中右键任务选择"▶ 开始"开始自动标注
- 可以随时右键任务选择"⏹ 停止"停止标注任务
- 标注结果将保存在数据集目录下的labels文件夹中
- 支持查看标注任务的进度和状态

### 5. 模型训练功能

#### 5.1 数据集划分
- 点击菜单栏"模型训练" -> "数据集划分"
- 选择数据集路径（包含图片和标注文件的目录）
- 选择输出路径（划分后的数据集保存位置）
- 设置训练集、验证集和测试集的比例（三者之和必须为1.0）
- 点击"开始划分"进行数据集划分
- 会生成符合YOLO格式的目录结构：
  ```
  output/
  ├── train/
  │   ├── images/
  │   └── labels/
  ├── val/
  │   ├── images/
  │   └── labels/
  ├── test/
  │   ├── images/
  │   └── labels/
  └── train.yml
  ```
- 同时会生成classes.txt文件和YOLO配置文件(train.yml)

### 6. 数据源管理功能

#### 6.1 数据源配置
- 点击菜单栏"数据源" -> "数据源管理"
- 点击"➕ 添加数据源"添加直播流数据源
- 需要配置直播源地址（如RTSP地址）和文件保存地址
- 支持编辑和删除已有的数据源配置

#### 6.2 播放直播流
- 在数据源列表中双击数据源或右键选择"▶ 播放"
- 可以实时播放和预览直播流
- 播放界面会替换主预览区域

### 7. 远程服务器功能

#### 7.1 服务器配置
- 点击菜单栏"文件上传" -> "服务器管理"
- 点击"➕ 添加服务器配置"添加远程服务器
- 需要配置主机地址、端口（默认22）、用户名和密码或私钥文件
- 支持测试连接功能验证配置是否正确
- 支持编辑和删除已有的服务器配置

#### 7.2 文件传输
- 在服务器列表中可以：
  - 点击"测试"测试服务器连接
  - 点击"上传"可以选择本地文件上传到服务器
  - 点击"下载"可以浏览远程目录并下载文件到本地
  - 点击"删除"删除服务器配置
- 上传文件时可以浏览远程目录选择目标路径
- 下载文件时需要选择本地保存目录

### 8. 菜单栏功能

#### 8.1 数据源菜单
- **数据源管理**: 管理直播流数据源

#### 8.2 自动标注菜单
- **模型配置**: 配置自动标注模型
- **自动标注**: 执行自动标注任务

#### 8.3 模型训练菜单
- **数据集划分**: 划分数据集为训练集、验证集和测试集

#### 8.4 文件上传菜单
- **服务器管理**: 管理远程服务器配置

#### 8.5 视图菜单
- **全屏模式**: 切换全屏模式 (快捷键 F11)

### 9. 界面布局说明

#### 9.1 主界面布局
- 采用三栏布局：左侧文件管理面板(20%)、中间预览面板(60%)、右侧详情面板(20%)
- 左侧文件管理面板：显示导入的文件夹和文件树
- 中间预览面板：显示选中文件的内容（图片、视频等）
- 右侧详情面板：显示文件的详细信息和标注数据

#### 9.2 预览面板内部布局
- 图片预览时分为左右两部分：
  - 左侧(80%)：图片显示区域，包含工具栏和滚动区域
  - 右侧(20%)：详情面板，显示标注信息
- 工具栏包含标注工具和快捷键提示

#### 9.3 详情面板内部布局
- 上部分(40%)：分类表格，按标签类别显示标注统计
- 下部分(60%)：详细表格，显示每个标注的形状、标签和点位信息

## 项目结构

```
dataset_manager/
├── main.py                           # 程序入口
├── src/                              # 源代码目录
│   ├── auto_annotation/              # 自动标注模块
│   │   ├── auto_annotation_panel.py  # 自动标注面板
│   │   └── model_config_panel.py     # 模型配置面板
│   ├── data_source/                  # 数据源模块
│   │   └── data_source_panel.py      # 数据源面板
│   ├── dataset_split/                # 数据集划分模块
│   │   └── dataset_split_panel.py    # 数据集划分面板
│   ├── file_manager/                 # 文件管理模块
│   │   ├── __init__.py
│   │   ├── file_manager_panel.py     # 文件管理面板
│   │   └── recycle_bin_panel.py      # 回收站对话框
│   ├── persist/                      # 持久化模块
│   │   └── yolo_utils.py             # YOLO工具函数
│   ├── preview/                      # 预览模块
│   │   ├── __init__.py
│   │   ├── image_preview_panel.py    # 图片预览面板
│   │   ├── preview_panel.py          # 预览面板
│   │   ├── video_preview_panel.py    # 视频预览面板
│   │   └── text_preview_panel.py     # 文本预览面板
│   ├── remote_server/                # 远程服务器模块
│   │   ├── file_transfer_dialog.py   # 文件传输对话框
│   │   ├── server_config.py          # 服务器配置
│   │   ├── server_config_panel.py    # 服务器配置面板
│   │   └── ssh_client.py             # SSH客户端
│   ├── ui/                           # 界面模块
│   │   ├── __init__.py
│   │   └── main_window.py            # 主窗口
│   └── __init__.py
├── requirements.txt                  # 依赖列表
└── README.md                         # 说明文档